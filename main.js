(()=>{var t={670:(t,e,r)=>{var n=r(111);t.exports=function(t){if(!n(t))throw TypeError(String(t)+" is not an object");return t}},318:(t,e,r)=>{var n=r(656),i=r(466),o=r(400),s=function(t){return function(e,r,s){var c,a=n(e),l=i(a.length),d=o(s,l);if(t&&r!=r){for(;l>d;)if((c=a[d++])!=c)return!0}else for(;l>d;d++)if((t||d in a)&&a[d]===r)return t||d||0;return!t&&-1}};t.exports={includes:s(!0),indexOf:s(!1)}},326:t=>{var e={}.toString;t.exports=function(t){return e.call(t).slice(8,-1)}},920:(t,e,r)=>{var n=r(871),i=r(887),o=r(236),s=r(70);t.exports=function(t,e){for(var r=i(e),c=s.f,a=o.f,l=0;l<r.length;l++){var d=r[l];n(t,d)||c(t,d,a(e,d))}}},880:(t,e,r)=>{var n=r(781),i=r(70),o=r(114);t.exports=n?function(t,e,r){return i.f(t,e,o(1,r))}:function(t,e,r){return t[e]=r,t}},114:t=>{t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},781:(t,e,r)=>{var n=r(293);t.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},317:(t,e,r)=>{var n=r(854),i=r(111),o=n.document,s=i(o)&&i(o.createElement);t.exports=function(t){return s?o.createElement(t):{}}},748:t=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},109:(t,e,r)=>{var n=r(854),i=r(236).f,o=r(880),s=r(320),c=r(505),a=r(920),l=r(705);t.exports=function(t,e){var r,d,u,p,h,f=t.target,m=t.global,y=t.stat;if(r=m?n:y?n[f]||c(f,{}):(n[f]||{}).prototype)for(d in e){if(p=e[d],u=t.noTargetGet?(h=i(r,d))&&h.value:r[d],!l(m?d:f+(y?".":"#")+d,t.forced)&&void 0!==u){if(typeof p==typeof u)continue;a(p,u)}(t.sham||u&&u.sham)&&o(p,"sham",!0),s(r,d,p,t)}}},293:t=>{t.exports=function(t){try{return!!t()}catch(t){return!0}}},5:(t,e,r)=>{var n=r(857),i=r(854),o=function(t){return"function"==typeof t?t:void 0};t.exports=function(t,e){return arguments.length<2?o(n[t])||o(i[t]):n[t]&&n[t][e]||i[t]&&i[t][e]}},854:(t,e,r)=>{var n=function(t){return t&&t.Math==Math&&t};t.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof r.g&&r.g)||function(){return this}()||Function("return this")()},871:(t,e,r)=>{var n=r(908),i={}.hasOwnProperty;t.exports=function(t,e){return i.call(n(t),e)}},501:t=>{t.exports={}},664:(t,e,r)=>{var n=r(781),i=r(293),o=r(317);t.exports=!n&&!i((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},361:(t,e,r)=>{var n=r(293),i=r(326),o="".split;t.exports=n((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==i(t)?o.call(t,""):Object(t)}:Object},788:(t,e,r)=>{var n=r(465),i=Function.toString;"function"!=typeof n.inspectSource&&(n.inspectSource=function(t){return i.call(t)}),t.exports=n.inspectSource},909:(t,e,r)=>{var n,i,o,s=r(536),c=r(854),a=r(111),l=r(880),d=r(871),u=r(465),p=r(200),h=r(501),f="Object already initialized",m=c.WeakMap;if(s){var y=u.state||(u.state=new m),v=y.get,b=y.has,g=y.set;n=function(t,e){if(b.call(y,t))throw new TypeError(f);return e.facade=t,g.call(y,t,e),e},i=function(t){return v.call(y,t)||{}},o=function(t){return b.call(y,t)}}else{var _=p("state");h[_]=!0,n=function(t,e){if(d(t,_))throw new TypeError(f);return e.facade=t,l(t,_,e),e},i=function(t){return d(t,_)?t[_]:{}},o=function(t){return d(t,_)}}t.exports={set:n,get:i,has:o,enforce:function(t){return o(t)?i(t):n(t,{})},getterFor:function(t){return function(e){var r;if(!a(e)||(r=i(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return r}}}},705:(t,e,r)=>{var n=r(293),i=/#|\.prototype\./,o=function(t,e){var r=c[s(t)];return r==l||r!=a&&("function"==typeof e?n(e):!!e)},s=o.normalize=function(t){return String(t).replace(i,".").toLowerCase()},c=o.data={},a=o.NATIVE="N",l=o.POLYFILL="P";t.exports=o},111:t=>{t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},913:t=>{t.exports=!1},536:(t,e,r)=>{var n=r(854),i=r(788),o=n.WeakMap;t.exports="function"==typeof o&&/native code/.test(i(o))},70:(t,e,r)=>{var n=r(781),i=r(664),o=r(670),s=r(593),c=Object.defineProperty;e.f=n?c:function(t,e,r){if(o(t),e=s(e,!0),o(r),i)try{return c(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},236:(t,e,r)=>{var n=r(781),i=r(296),o=r(114),s=r(656),c=r(593),a=r(871),l=r(664),d=Object.getOwnPropertyDescriptor;e.f=n?d:function(t,e){if(t=s(t),e=c(e,!0),l)try{return d(t,e)}catch(t){}if(a(t,e))return o(!i.f.call(t,e),t[e])}},6:(t,e,r)=>{var n=r(324),i=r(748).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return n(t,i)}},181:(t,e)=>{e.f=Object.getOwnPropertySymbols},324:(t,e,r)=>{var n=r(871),i=r(656),o=r(318).indexOf,s=r(501);t.exports=function(t,e){var r,c=i(t),a=0,l=[];for(r in c)!n(s,r)&&n(c,r)&&l.push(r);for(;e.length>a;)n(c,r=e[a++])&&(~o(l,r)||l.push(r));return l}},296:(t,e)=>{"use strict";var r={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,i=n&&!r.call({1:2},1);e.f=i?function(t){var e=n(this,t);return!!e&&e.enumerable}:r},887:(t,e,r)=>{var n=r(5),i=r(6),o=r(181),s=r(670);t.exports=n("Reflect","ownKeys")||function(t){var e=i.f(s(t)),r=o.f;return r?e.concat(r(t)):e}},857:(t,e,r)=>{var n=r(854);t.exports=n},320:(t,e,r)=>{var n=r(854),i=r(880),o=r(871),s=r(505),c=r(788),a=r(909),l=a.get,d=a.enforce,u=String(String).split("String");(t.exports=function(t,e,r,c){var a,l=!!c&&!!c.unsafe,p=!!c&&!!c.enumerable,h=!!c&&!!c.noTargetGet;"function"==typeof r&&("string"!=typeof e||o(r,"name")||i(r,"name",e),(a=d(r)).source||(a.source=u.join("string"==typeof e?e:""))),t!==n?(l?!h&&t[e]&&(p=!0):delete t[e],p?t[e]=r:i(t,e,r)):p?t[e]=r:s(e,r)})(Function.prototype,"toString",(function(){return"function"==typeof this&&l(this).source||c(this)}))},488:t=>{t.exports=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t}},505:(t,e,r)=>{var n=r(854),i=r(880);t.exports=function(t,e){try{i(n,t,e)}catch(r){n[t]=e}return e}},200:(t,e,r)=>{var n=r(309),i=r(711),o=n("keys");t.exports=function(t){return o[t]||(o[t]=i(t))}},465:(t,e,r)=>{var n=r(854),i=r(505),o="__core-js_shared__",s=n[o]||i(o,{});t.exports=s},309:(t,e,r)=>{var n=r(913),i=r(465);(t.exports=function(t,e){return i[t]||(i[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.12.0",mode:n?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},400:(t,e,r)=>{var n=r(958),i=Math.max,o=Math.min;t.exports=function(t,e){var r=n(t);return r<0?i(r+e,0):o(r,e)}},656:(t,e,r)=>{var n=r(361),i=r(488);t.exports=function(t){return n(i(t))}},958:t=>{var e=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:e)(t)}},466:(t,e,r)=>{var n=r(958),i=Math.min;t.exports=function(t){return t>0?i(n(t),9007199254740991):0}},908:(t,e,r)=>{var n=r(488);t.exports=function(t){return Object(n(t))}},593:(t,e,r)=>{var n=r(111);t.exports=function(t,e){if(!n(t))return t;var r,i;if(e&&"function"==typeof(r=t.toString)&&!n(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!n(i=r.call(t)))return i;if(!e&&"function"==typeof(r=t.toString)&&!n(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},711:t=>{var e=0,r=Math.random();t.exports=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++e+r).toString(36)}},817:(t,e,r)=>{"use strict";var n=r(109),i=r(781),o=r(854),s=r(871),c=r(111),a=r(70).f,l=r(920),d=o.Symbol;if(i&&"function"==typeof d&&(!("description"in d.prototype)||void 0!==d().description)){var u={},p=function(){var t=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),e=this instanceof p?new d(t):void 0===t?d():d(t);return""===t&&(u[e]=!0),e};l(p,d);var h=p.prototype=d.prototype;h.constructor=p;var f=h.toString,m="Symbol(test)"==String(d("test")),y=/^Symbol\((.*)\)[^)]+$/;a(h,"description",{configurable:!0,get:function(){var t=c(this)?this.valueOf():this,e=f.call(t);if(s(u,t))return"";var r=m?e.slice(7,-1):e.replace(y,"$1");return""===r?void 0:r}}),n({global:!0,forced:!0},{Symbol:p})}}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,r),o.exports}r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";r(817);const t=new class{generate(t){if(!1===t||null==t)return document.createTextNode("");if("string"!=typeof t.type)return document.createTextNode("");const e=document.createElement(`${t.type}`);return t.attr&&Object.entries(t.attr).forEach((([t,r])=>{"class"===t?e.className=r.join(" "):e.setAttribute(t,r)})),t.listener&&e.addEventListener(t.listener.type,t.listener.cb),"string"==typeof t.content?(""===t.content&&(e.textContent=""),e.textContent=t.content):Array.isArray(t.content)?t.content.forEach((t=>e.appendChild(this.generate(t)))):"object"==typeof t.content&&e.appendChild(this.generate(t.content)),e}};const e=new class{constructor(){this.handlers=[]}subscribe(t,e,r){void 0===r&&(r=e),this.handlers.push({event:t,handler:e.bind(r)})}emit(t,...e){1===e.length&&(e=e[0]),this.handlers.forEach((r=>{r.event===t&&r.handler(e)}))}};class n{constructor({id:t,name:e,description:r,status:n,created:i}){this.id=t,this.name=e,this.description=r,this.status=n,this.created=i}render(){const e=new Date(this.created),r=`${e.toLocaleDateString()} ${e.toLocaleTimeString().slice(0,5)}`;return t.generate({type:"div",attr:{class:["ticket"],"data-id":this.id},content:[{type:"div",attr:{class:["ticket__body"]},content:[{type:"div",attr:{class:["ticket__status"]},listener:{type:"click",cb:t=>this.changeStatus(t)},content:{type:"span",attr:{class:this.status?["done"]:[]},content:""}},{type:"div",attr:{class:["ticket__name"]},listener:{type:"click",cb:this.showDescription},content:this.name},{type:"div",attr:{class:["ticket__created"]},content:r},{type:"div",attr:{class:["ticket__edit"]},listener:{type:"click",cb:t=>this.editTicket(t)},content:{type:"span",attr:{class:["ticket__edit-img"]},content:""}},{type:"div",attr:{class:["ticket__delete"]},listener:{type:"click",cb:t=>this.deleteTicket(t)},content:{type:"span",attr:{class:["ticket__delete-img"]},content:""}}]},{type:"div",attr:{class:["ticket__description","hidden"]},content:this.description}]})}showDescription(t){t.target.closest(".ticket").querySelector(".ticket__description").classList.toggle("hidden")}changeStatus(t){const r=t.target.closest(".ticket"),{id:n}=r.dataset;e.emit("changeStatus",n)}editTicket(t){const r=t.target.closest(".ticket"),{id:n}=r.dataset;e.emit("edit",n)}deleteTicket(t){const r=t.target.closest(".ticket"),{id:n}=r.dataset;e.emit("delete",n)}}const i={type:"div",attr:{class:["container"]},content:[{type:"div",attr:{class:["ticket__header"]},content:{type:"h1",attr:{class:["ticket__title"]},content:"Help Desk"}},{type:"div",attr:{class:["ticket__add"]},content:"Add ticket"},{type:"div",attr:{class:["ticket__container"]},content:""}]},o={type:"div",attr:{class:["ticket__empty"]},content:"There are no tickets at the moment."};const s=async t=>{const e=`https://art-helpdesk.herokuapp.com/?${t.query}`,r=await fetch(e,{method:t.method,body:t.data?JSON.stringify(t.data):null}),n=await r.json();return t.callback&&t.callback(n),n};class c extends class{list(){}get(){}create(){}update(){}delete(){}}{list(t){return s({method:"GET",query:"method=allTickets",callback:t})}get(t,e){return s({method:"GET",query:`method=ticketById&id=${t}`,callback:e})}create(t,e){return s({method:"POST",query:"method=createTicket",data:t,callback:e})}update(t,e,r){return s({method:"POST",query:`method=updateById&id=${t}`,data:e,callback:r})}delete(t,e){return s({method:"GET",query:`method=deleteById&id=${t}`,callback:e})}}class a{constructor(t){if(!(t instanceof HTMLElement))throw new Error("Передайте HTML элемент");this.container=t}render(){return t.generate({type:"div",attr:{class:["modal__form"]},content:[{type:"div",attr:{class:["modal__background"]},content:""},{type:"div",attr:{class:["modal__content"]},content:[{type:"div",attr:{class:["modal__header"]},content:""},{type:"div",attr:{class:["modal__body"]},content:{type:"form",attr:{class:["modal__form"],name:"modal-form"},content:[{type:"div",attr:{class:["form__group"]},content:[{type:"label",attr:{class:["form__label"],for:"short-description"},content:"Short description"},{type:"input",attr:{class:["form__input"],id:"short-description",name:"name",placeholder:"Please enter a short description..."},content:""}]},{type:"div",attr:{class:["form__group"]},content:[{type:"label",attr:{class:["form__label"],for:"short-description"},content:"Detailed description"},{type:"textarea",attr:{class:["form__textarea"],id:"detailed-description",name:"description",placeholder:"Please enter a detailed description..."},content:""}]}]}},{type:"div",attr:{class:["modal__footer"]},content:[{type:"div",attr:{class:["modal__close"]},listener:{type:"click",cb:t=>this.close(t)},content:"Close"},{type:"div",attr:{class:["modal__ok"]},listener:{type:"click",cb:()=>this.submit()},content:"Ok"}]}]}]})}bindToDOM(){this.container.appendChild(this.render())}submit(){const{formElement:t}=this,r={name:t.elements.name.value,description:t.elements.description.value};this.modalElement.querySelector(".modal__header").textContent="",this.close(),e.emit("submit",r,this.type),this.type=null}close(){this.clearForm(),this.modalElement.classList.remove("active")}showModal(t,e){const r=this.modalElement.querySelector(".modal__header");if(this.type=t,"create"===t&&(r.textContent="Register new ticket",this.modalElement.classList.add("active")),"edit"===t){const{formElement:t}=this;t.elements.name.value=e.name,t.elements.description.value=e.description||"No information",r.textContent="Edit ticket",this.modalElement.classList.add("active")}}get modalElement(){return this.container.querySelector(".modal__form")}get formElement(){return this.modalElement.querySelector("form")}clearForm(){const{formElement:t}=this;t.elements.name.value="",t.elements.description.value=""}}class l{constructor(t){if(!(t instanceof HTMLElement))throw new Error("Передайте HTML элемент");this.container=t}render(){return t.generate({type:"div",attr:{class:["modal__delete"]},content:[{type:"div",attr:{class:["modal__background"]},content:""},{type:"div",attr:{class:["modal__content"]},content:[{type:"div",attr:{class:["modal__header"]},content:""},{type:"div",attr:{class:["modal__body"]},content:"Are you sure you want to delete this ticket? This action is irreversible."},{type:"div",attr:{class:["modal__footer"]},content:[{type:"div",attr:{class:["modal__close"]},listener:{type:"click",cb:t=>this.close(t)},content:"Close"},{type:"div",attr:{class:["modal__ok"]},listener:{type:"click",cb:()=>this.submit()},content:"Ok"}]}]}]})}bindToDOM(){this.container.appendChild(this.render())}submit(){e.emit("deleteTicket"),this.modalElement.classList.remove("active")}close(){this.modalElement.classList.remove("active")}showModal(){this.modalElement.querySelector(".modal__header").textContent="Warning!",this.modalElement.classList.add("active")}get modalElement(){return this.container.querySelector(".modal__delete")}}const d=document.getElementById("root");new class{constructor(t){if(!(t instanceof HTMLElement))throw new Error("This is not HTML element!");this.container=t,this.api=new c}init(){this.bindToDOM(),this.registerEvents(),this.subscribeOnEvents(),this.modalWithForm=new a(this.container),this.modalWithForm.bindToDOM(),this.modalDelete=new l(this.container),this.modalDelete.bindToDOM(),this.api.list(this.renderTickets.bind(this))}subscribeOnEvents(){e.subscribe("submit",this.obSubmit,this),e.subscribe("deleteTicket",this.deleteTicket,this),e.subscribe("edit",this.editTicket,this),e.subscribe("delete",this.showModalDelete,this),e.subscribe("changeStatus",this.changeStatus,this)}bindToDOM(){this.container.appendChild(t.generate(i))}registerEvents(){this.container.querySelector(".ticket__add").addEventListener("click",(()=>this.modalWithForm.showModal("create")))}get ticketContainer(){return this.container.querySelector(".ticket__container")}renderTickets(e=[]){0!==e.length?e.forEach((t=>{const e=new n(t);this.ticketContainer.appendChild(e.render())})):this.ticketContainer.appendChild(t.generate(o))}async obSubmit([t,e]){if("create"!==e){if("edit"===e){const{id:e}=this.currentEditObject;await this.api.update(e,t,(t=>{this.ticketContainer.textContent="",this.renderTickets(t)})),this.currentEditObject=null}}else await this.api.create(t,(t=>{this.renderTickets(t)}))}async editTicket(t){this.currentEditObject=await this.api.get(t),this.modalWithForm.showModal("edit",this.currentEditObject)}async changeStatus(t){this.currentEditObject=await this.api.get(t),this.currentEditObject.status=!this.currentEditObject.status,await this.api.update(t,this.currentEditObject,(t=>{this.ticketContainer.textContent="",this.renderTickets(t)})),this.currentEditObject=null}async deleteTicket(){await this.api.delete(this.currentEditObject.id,(t=>{this.ticketContainer.textContent="",this.renderTickets(t)})),this.currentEditObject=null}async showModalDelete(t){this.currentEditObject=await this.api.get(t),this.modalDelete.showModal()}}(d).init()})()})();